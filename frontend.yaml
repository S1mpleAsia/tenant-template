apiVersion: apps/v1 # API version
kind: Deployment # Type of kubernetes resource
metadata:
  name: ${serviceName}-deployment # Name of the kubernetes resource
  namespace: ${namespace}
spec:
  replicas: ${deploymentReplicas} # No of replicas/pods to run
  selector:
    matchLabels: # This deployment applies to Pods matching the specified labels
      app: ${serviceName}
  template: # Template for creating the Pods in this deployment
    metadata:
      labels: # Labels that will be applied to all the Pods in this deployment
        app: ${serviceName}
    spec: # Spec for the containers that will run inside the Pods
      containers:
        - name: ${serviceName}
          image: ${DOCKER_REGISTRY}/${imageName}:${imageVersion}
          imagePullPolicy: ${imagePullPolicy}
          ports:
            - containerPort: ${containerPort} # Should match the Port that the container listens on
---
apiVersion: v1 # API version
kind: Service # Type of kubernetes resource
metadata:
  name: ${serviceName} # Name of the kubernetes resource
  namespace: ${namespace}
spec:
  type: ${serviceType} # Exposes the service by opening a port on each node
  selector:
    app: ${serviceName} # Any Pod matching the label `app=polling-app-client` will be picked up by this service
  ports: # Forward incoming connections on port 80 to the target port 80 in the Pod
    - port: ${containerPort}
      targetPort: ${containerPort}
